<!DOCTYPE HTML>

<html>

	<head>


		<script type="text/javascript" src="js/jquery-1.9.1.min.js"></script>

		<link href="css/bootstrap.min.css" rel="stylesheet">
		<link href="css/bootstrap-responsive.min.css" rel="stylesheet">
		<link href="css/urmoviereviews.css" rel="stylesheet">
		<link href="css/jquery-ui-1.10.2.custom.min.css" rel="stylesheet">
		

		<script type="text/javascript" src="js/bootstrap.min.js"></script>
		<script type="text/javascript" src="js/jquery-ui-1.10.2.custom.min.js"></script>

		<script>

		


		function searchMovies(request, response) {
		    console.log(request);
		    $.ajax({
		        url: "http://www.omdbapi.com/?s=" + request['term'] + "&r=JSON",
		        type: "GET",
		        dataType: "json",
		        success: function (data) {
		            var searchArray = data['Search'];
		            var results = [];
		            for(var i = 0; i < searchArray.length; i++) {
		                results.push({label: searchArray[i]['Title']+" ("+searchArray[i]['Year']+")", id: searchArray[i]['imdbID']});
		            }
		            response(results);
		        }
		        
		        }); //End of ajax

		};// End of searchMovies function


		function grabMovieInfo (ui) {
			
			// console.log(ui.item);	

					$.ajax({
			        url: "http://www.omdbapi.com/?i=" + ui.item.id + "&tomatoes=true",
			        type: "GET",
			        dataType: "json",
			        success: function (data) {
			            	console.log(data);
			            	console.log(data.tomatoMeter);
			            	populateMovieInfo(data);

			            }
			 
			        
			        }); //End of ajax
		};


		function populateMovieInfo(data) {
			$('#putMovieInfo').html(" ");
			$('#putMovieInfo').append('<input type="hidden" id="posterInput" value="'+data.Poster+'"><img id="moviePoster" src="'+data.Poster+'"></img><div id="movieInfo"><input type="hidden" id="titleInput" value="'+data.Title+'"><div id="title">'+data.Title+'</div><input type="hidden" id="yearInput" value="'+data.Year+'"><div id="year">('+data.Year+')</div><input type="hidden" id="ratedInput" value="'+data.Rated+'"><div id="rated">'+data.Rated+'</div><input type="hidden" id="lengthInput" value="'+data.Runtime+'"><div id="length">'+data.Runtime+'</div><input type="hidden" id="genreInput" value="'+data.Genre+'"><div id="genre">'+data.Genre+'</div><input type="hidden" id="releasedInput" value="'+data.Released+'"><div id="released">'+data.Released+'</div><input type="hidden" id="plotInput" value="'+data.Plot+'"><div id="plot">'+data.Plot+'</div><input type="hidden" id="directorInput" value="'+data.Director+'"><div id="director">Director: '+data.Director+'</div><input type="hidden" id="writerInput" value="'+data.Writer+'"><div id="writer">Writer: '+data.Writer+'</div><input type="hidden" id="actorsInput" value="'+data.Actors+'"><div id="actors">Stars: '+data.Actors+'</div></div>');

		};


	//*********************** DOCUMENT.READY STARTS HERE **************************

		$(document).ready(function() {


			$('#movieTable').tooltip({
      selector: "a[data-toggle=tooltip]", html: "true"
    })

			$.ajax({
			url: "backliftapp/movieDatabase",
			type: "GET",
			dataType: "json",
			success: function (data) {
				for(var i = 0; i < data.length; i++) {
					refreshMovieTable(data[i]);
				}
				}

			}); //End of ajax



    		$("#testing").autocomplete( { source: searchMovies, delay: 800, select: function(select, ui) {grabMovieInfo(ui);} });
   

			$('#submitMovieReview').click(function() {
				reviewedMovie = {
				poster: $("#posterInput").val(),
				title: $("#titleInput").val(),
				rating: $("#ratedInput").val(),
				runtime: $("#lengthInput").val(),
				yearReleased: $("#yearInput").val(),
				dateWatched: $("#movieDateWatched").val(),
				review: $("#review").val()
				};

				$.ajax({
					url: "backliftapp/movieDatabase",
					type: "POST",
					dataType: "json",
					data: reviewedMovie,
					success: function (data) {
						addMovieToTable(data);
					}
				});


				
				


			}); // End of submitData.click

			

		function addMovieToTable (reviewedMovie) {
			$('#movieTable').append('<tr><td><img class="posterThumbnail" src="'+reviewedMovie.poster+'" style="max-height: 40px;"/></td><td><a href="#" data-toggle="tooltip" title data-original-title="<img src='+reviewedMovie.poster+'></img>Review: '+reviewedMovie.review+' ">'+reviewedMovie.title+'</a></td><td>?</td><td>'+reviewedMovie.yearReleased+'</td><td>'+reviewedMovie.dateWatched+'</td><td>'+reviewedMovie.rating+'</td><td>'+reviewedMovie.runtime+'</td><td><button id="deleteButton" type="submit" class="btn" onClick="deleteMovie(\'' + reviewedMovie.id + '\')">delete</button></td></tr>')

		};

		function refreshMovieTable (reviewedMovie) {
			$('<tr><td title="Review: '+reviewedMovie.review+'">'+reviewedMovie.title+'</td><td>?</td><td>'+reviewedMovie.yearReleased+'</td><td>'+reviewedMovie.dateWatched+'</td><td>'+reviewedMovie.rating+'</td><td>'+reviewedMovie.runtime+'</td><td><button id="deleteButton" type="submit" class="btn" onClick="deleteMovie(\'' + reviewedMovie.id + '\')">delete</button></td></tr>').appendTo('#movieTable');

		};

		


			

		});//End of doc.ready function


function deleteMovie (id) {
			  var conf = confirm("Are you sure you want to delete this movie?");
			  if (conf == true) {
			    $.ajax({
			      url: "backliftapp/movieDatabase/" + id,
			      type: "DELETE",
			      dataType: "json",
			      success: function () {
			      	
			      }
			    })
			};
			
	}; // End of deleteMovie

		</script>
	</head>




	<body>

		<div class="container">

			<div class="row>"
				<div class="span12 box">

					<!--Form to Write Ur Review-->
					<label for="testing">Search for A Movie</label>
					<input id="testing">
					<br>
					<br>
					<div id="putMovieInfo">

					</div>

					<form>
			 			<label for="movieDateWatched">Date Watched</label>
			 			<input id="movieDateWatched" type="text" placeholder="" style="width: 75px; height: 30px;">
			 			<br>
			 			<label for="review">Write Ur Review</label>
						<textarea id="review" style="width: 700px; height: 200px;"></textarea>
					</form>
					<button id="submitMovieReview" type="submit" class="btn" aria-hidden="true">Submit</button>
					<br>
					<table id="urReviews" class="table table-hover">
						<thead>
							<tr><th> </th><th> Title </th><th>Grade</th><th>Year Released</th><th>Date Watched</th><th>Rating</th><th>Runtime</th></tr>
						</thead>
						<tbody id="movieTable">
							<tr>
								</td>
							</tr>
						</tbody>
					</table>

				</div> <!--End of div span12 box -->
			</div><!-- End of row -->
			 

		</div> <!-- End of container div -->

	</body>


</html>